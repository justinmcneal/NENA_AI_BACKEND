{% extends 'admin/base_site.html' %}
{% load static %}

{% block content %}
<div id="content-main">

    <div class="module">
        <h2>Request Details</h2>
        <p><strong>Request Type:</strong> {{ user_request.request_type }}</p>
        <p><strong>Description:</strong> {{ user_request.description }}</p>
        <p><strong>Status:</strong> {{ user_request.status }}</p>
        <p><strong>Submission Date:</strong> {{ user_request.submission_date }}</p>
    </div>

    <div class="module">
        <h2>Loan Information</h2>
        {% if loans %}
            {% for loan in loans %}
                <p><strong>Loan Code:</strong> {{ loan.loan_code }}</p>
                <p><strong>Loaned Amount:</strong> {{ loan.loaned_amount }}</p>
                <p><strong>Amount Payable:</strong> {{ loan.amount_payable }}</p>
                <p><strong>Monthly Repayment:</strong> {{ loan.monthly_repayment }}</p>
                <p><strong>Months Left:</strong> {{ loan.months_left }}</p>
                <p><strong>Loan Term:</strong> {{ loan.loan_term }}</p>
                <p><strong>Monthly Income:</strong> {{ loan.monthly_income }}</p>
                <p><strong>Created At:</strong> {{ loan.created_at }}</p>
                <p><strong>Verified by Bank:</strong> {{ loan.is_verified_by_bank }}</p>
                <hr>
            {% endfor %}
        {% else %}
            <p>No loan information available for this user.</p>
        {% endif %}
    </div>

    <div class="module">
        <h2>Attachments</h2>
        {% if attachments %}
            <ul>
                {% for attachment in attachments %}
                    <li>
                        <a href="{{ attachment.file.url }}" target="_blank">{{ attachment.file.name }}</a>
                        {% if attachment.description %}({{ attachment.description }}){% endif %}
                        {% if attachment.file.url|lower|slice:'-4:' == ".pdf" %}
                            <br><iframe src="{{ attachment.file.url }}" width="600" height="400" style="border: none;"></iframe>
                        {% elif attachment.file.url|lower|slice:'-4:' == ".jpg" or attachment.file.url|lower|slice:'-4:' == ".png" or attachment.file.url|lower|slice:'-5:' == ".jpeg" or attachment.file.url|lower|slice:'-4:' == ".gif" %}
                            <br><img src="{{ attachment.file.url }}" style="max-width: 600px; max-height: 400px; border: 1px solid #ccc;">
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No attachments for this request.</p>
        {% endif %}
    </div>

    <div class="submit-row">
        <p class="deletelink-box"><a href="{% url 'admin:documents_userrequest_change' user_request.pk %}" class="deletelink">Edit Request</a></p>
        <p class="changelink-box"><a href="{% url 'admin:documents_userrequest_changelist' %}" class="changelink">Back to Request List</a></p>
    </div>
</div>
{% endblock %}